<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Sentence Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4a5568;
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .word-button {
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .word-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .subject {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .verb {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .object {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .sentence-builder {
            background: #f7fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .sentence-part {
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .selected-subject {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .selected-verb {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .selected-object {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .clear-button {
            background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
        }

        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .placeholder {
            color: #a0aec0;
            font-style: italic;
        }

        .conjugation-info {
            background: #edf2f7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
            color: #4a5568;
        }

        .add-vocab-section {
            background: #f0fff4;
            border: 2px solid #68d391;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        .add-noun-section {
            background: #ebf8ff;
            border: 2px solid #63b3ed;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }

        .add-vocab-title, .add-noun-title {
            color: #2f855a;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }
        .add-noun-title {
            color: #2b6cb0;
        }

        .vocab-form, .noun-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        .noun-form {
            grid-template-columns: 1fr auto; /* Nouns don't have a 'type' select */
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #68d391;
        }
        .form-input.noun-input:focus {
            border-color: #63b3ed;
        }

        .form-select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .add-button {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            height: fit-content;
            transition: transform 0.3s ease;
        }
        .add-button.noun-button {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        .add-button:hover {
            transform: translateY(-2px);
        }

        .custom-verbs, .custom-nouns {
            margin-top: 20px;
        }

        .custom-verb-tag, .custom-noun-tag {
            display: inline-block;
            background: #68d391;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin: 4px;
            position: relative;
        }
        .custom-noun-tag {
            background: #63b3ed;
        }

        .remove-verb, .remove-noun {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .toggle-vocab, .toggle-noun {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
        }
        .toggle-noun {
            background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
        }

        .toggle-vocab:hover, .toggle-noun:hover {
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåü Constructor de Oraciones en Espa√±ol</h1>
        
        <div class="section">
            <div class="section-title">üìç Sujeto (Subject)</div>
            <div class="word-grid">
                <button class="word-button subject" onclick="selectSubject('yo')">yo</button>
                <button class="word-button subject" onclick="selectSubject('t√∫')">t√∫</button>
                <button class="word-button subject" onclick="selectSubject('√©l')">√©l</button>
                <button class="word-button subject" onclick="selectSubject('ella')">ella</button>
                <button class="word-button subject" onclick="selectSubject('nosotros')">nosotros</button>
                <button class="word-button subject" onclick="selectSubject('ustedes')">ustedes</button>
                <button class="word-button subject" onclick="selectSubject('ellos')">ellos</button>
                <button class="word-button subject" onclick="selectSubject('ellas')">ellas</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">‚ö° Verbo (Verb)</div>
            <div class="word-grid" id="verbGrid">
                </div>
        </div>

        <div class="section">
            <div class="section-title">üéØ Objeto (Object)</div>
            <div class="word-grid" id="objectGrid">
                </div>
        </div>

        <div class="sentence-builder" id="sentenceBuilder">
            <span class="placeholder">Selecciona las palabras para construir tu oraci√≥n...</span>
        </div>

        <button class="clear-button" onclick="clearSentence()">üîÑ Limpiar Oraci√≥n</button>

        <button class="toggle-vocab" onclick="toggleVocabSection()">‚ûï A√±adir Verbos</button>

        <div class="add-vocab-section hidden" id="vocabSection">
            <div class="add-vocab-title">üå± A√±ade tus propios verbos</div>
            
            <div class="vocab-form">
                <div class="form-group">
                    <label class="form-label">Verbo (infinitivo)</label>
                    <input type="text" class="form-input" id="newVerb" placeholder="ej: caminar, correr, salir...">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tipo de verbo</label>
                    <select class="form-select" id="verbType">
                        <option value="regular-ar">Regular -AR (como hablar)</option>
                        <option value="regular-er">Regular -ER (como comer)</option>
                        <option value="regular-ir">Regular -IR (como vivir)</option>
                        <option value="irregular">Irregular (necesita conjugaciones especiales)</option>
                    </select>
                </div>
                
                <button class="add-button" onclick="addNewVerb()">‚ûï A√±adir</button>
            </div>

            <div class="custom-verbs" id="customVerbs">
                <div style="font-weight: 600; color: #2d3748; margin-bottom: 10px;">Verbos a√±adidos:</div>
            </div>
        </div>

        <button class="toggle-noun" onclick="toggleNounSection()">‚ûï A√±adir Sustantivos</button>

        <div class="add-noun-section hidden" id="nounSection">
            <div class="add-noun-title">üìö A√±ade tus propios sustantivos</div>
            
            <div class="noun-form">
                <div class="form-group">
                    <label class="form-label">Sustantivo</label>
                    <input type="text" class="form-input noun-input" id="newNoun" placeholder="ej: la casa, el perro, las flores...">
                </div>
                
                <button class="add-button noun-button" onclick="addNewNoun()">‚ûï A√±adir</button>
            </div>

            <div class="custom-nouns" id="customNouns">
                <div style="font-weight: 600; color: #2d3748; margin-bottom: 10px;">Sustantivos a√±adidos:</div>
            </div>
        </div>


        <div class="conjugation-info" id="conjugationInfo" style="display: none;">
            <strong>üí° Informaci√≥n de conjugaci√≥n:</strong>
            <div id="conjugationDetails"></div>
        </div>
    </div>

    <script>
        let selectedSubject = null;
        let selectedVerb = null;
        let selectedObject = null;
        let allVerbsData = {}; 
        let customVerbs = []; 
        let customNouns = []; 

        const defaultObjects = ['el libro', 'la comida', 'el espa√±ol', 'la m√∫sica', 'el agua', 'la carta', 'el trabajo', 'la pel√≠cula'];

        // !! IMPORTANT !!
        // Replace this with the RAW URL of your verbs.json file on GitHub
        const VERBS_JSON_URL = 'https://raw.githubusercontent.com/irwingbrian/languagelearningtool/refs/heads/main/verbs.json';
        // Example: 'https://raw.githubusercontent.com/Gemini-AI/spanish-tool-data/main/verbs.json';

        // --- localStorage Helper Functions ---
        function saveCustomData() {
            try {
                localStorage.setItem('customVerbs', JSON.stringify(customVerbs));
                localStorage.setItem('customNouns', JSON.stringify(customNouns));
            } catch (e) {
                console.error("Error saving to localStorage:", e);
                alert("Error al guardar tus palabras personalizadas. El almacenamiento local podr√≠a estar lleno o deshabilitado.");
            }
        }

        function loadCustomData() {
            try {
                const storedVerbs = localStorage.getItem('customVerbs');
                const storedNouns = localStorage.getItem('customNouns');
                
                if (storedVerbs) {
                    customVerbs = JSON.parse(storedVerbs);
                }
                if (storedNouns) {
                    customNouns = JSON.parse(storedNouns);
                }
            } catch (e) {
                console.error("Error loading from localStorage:", e);
                alert("Error al cargar tus palabras personalizadas. Podr√≠an estar corruptas.");
                // Clear potentially bad data
                localStorage.removeItem('customVerbs');
                localStorage.removeItem('customNouns');
                customVerbs = [];
                customNouns = [];
            }
        }

        // Function to fetch verbs data
        async function fetchVerbsData() {
            try {
                const response = await fetch(VERBS_JSON_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                allVerbsData = data; 
                updateVerbGrid(); 
            } catch (error) {
                console.error("Could not fetch verbs data:", error);
                alert("Error loading verb data. Please check the JSON URL or your internet connection. Default verbs might not be available.");
                // Optionally, fall back to some default hardcoded verbs if fetch fails
                // For now, we'll just proceed with an empty allVerbsData if fetch fails.
            }
        }

        // Conjugation engine for regular verbs
        function conjugateRegularVerb(verb, type, subject) {
            const stem = verb.slice(0, -2); 
            
            const endings = {
                'regular-ar': {
                    'yo': 'o', 't√∫': 'as', '√©l': 'a', 'ella': 'a', 'usted': 'a', 
                    'nosotros': 'amos', 'ustedes': 'an', 'ellos': 'an', 'ellas': 'an' 
                },
                'regular-er': {
                    'yo': 'o', 't√∫': 'es', '√©l': 'e', 'ella': 'e', 'usted': 'e',
                    'nosotros': 'emos', 'ustedes': 'en', 'ellos': 'en', 'ellas': 'en' 
                },
                'regular-ir': {
                    'yo': 'o', 't√∫': 'es', '√©l': 'e', 'ella': 'e', 'usted': 'e',
                    'nosotros': 'imos', 'ustedes': 'en', 'ellos': 'en', 'ellas': 'en' 
                }
            };
            return stem + endings[type][subject];
        }

        // This function is new or significantly modified from previous steps.
        // It's responsible for generating the full conjugation for a regular verb
        // based on its type (-ar, -er, -ir) and creating the structure expected
        // by the allVerbsData object.
        function generateConjugation(verb, type) {
            const conjugation = {};
            const subjects = ['yo', 't√∫', '√©l', 'ella', 'usted', 'nosotros', 'ustedes', 'ellos', 'ellas']; 
            
            subjects.forEach(subject => {
                // 'ustedes' uses the same conjugation ending as 'ellos' and 'ellas' for regular verbs in Latin American Spanish
                const effectiveSubject = (subject === 'ustedes' || subject === 'usted') ? 'ellos' : subject; // This line might need refinement if 'usted' conjugates like '√©l'/'ella'
                // Re-evaluate how 'usted' is handled here. For regular verbs, 'usted' is 'a' for -ar, 'e' for -er/-ir.
                // It should follow '√©l'/'ella'. Let's ensure the regular conjugation uses `subject` directly.
                conjugation[subject] = conjugateRegularVerb(verb, type, subject);
            });

            return conjugation;
        }

        // --- Selection Functions ---
        function selectSubject(subject) {
            selectedSubject = subject;
            updateSentence();
        }

        function selectVerb(verb) {
            selectedVerb = verb;
            updateSentence();
        }

        function selectObject(object) {
            selectedObject = object;
            updateSentence();
        }

        // --- Grid Update Functions ---
        function updateVerbGrid() {
            const verbGrid = document.getElementById('verbGrid');
            verbGrid.innerHTML = ''; 

            const allVerbsToDisplay = { ...allVerbsData }; 
            customVerbs.forEach(verbData => {
                // Ensure custom regular verbs have their full conjugations generated
                if (verbData.type !== 'irregular' && !verbData.conjugations) {
                    verbData.conjugations = generateConjugation(verbData.verb, verbData.type);
                }
                allVerbsToDisplay[verbData.verb] = verbData; // Add/overwrite with custom verbs
            });

            const verbInfinitives = Object.keys(allVerbsToDisplay).sort();

            verbInfinitives.forEach(verb => {
                const button = document.createElement('button');
                button.className = 'word-button verb';
                button.textContent = verb;
                button.onclick = () => selectVerb(verb);
                
                if (customVerbs.some(v => v.verb === verb)) {
                    button.style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                } else if (allVerbsToDisplay[verb].type === 'irregular') {
                    button.style.background = 'linear-gradient(135deg, #e07a5f 0%, #a43a3d 100%)'; 
                }
                
                verbGrid.appendChild(button);
            });
        }

        function updateObjectGrid() {
            const objectGrid = document.getElementById('objectGrid');
            objectGrid.innerHTML = ''; 
            
            const allNounsToDisplay = [...defaultObjects, ...customNouns].sort();

            allNounsToDisplay.forEach(object => {
                const button = document.createElement('button');
                button.className = 'word-button object';
                button.textContent = object;
                button.onclick = () => selectObject(object);
                if (customNouns.includes(object)) {
                    button.style.background = 'linear-gradient(135deg, #4299e1 0%, #3182ce 100%)';
                }
                objectGrid.appendChild(button);
            });
        }

        // --- Section Toggle Functions ---
        function toggleVocabSection() {
            const section = document.getElementById('vocabSection');
            section.classList.toggle('hidden');
        }

        function toggleNounSection() {
            const section = document.getElementById('nounSection');
            section.classList.toggle('hidden');
        }

        // --- Add/Remove Vocabulary Functions ---
        function addNewVerb() {
            const verbInput = document.getElementById('newVerb');
            const typeSelect = document.getElementById('verbType');
            
            const verb = verbInput.value.trim().toLowerCase();
            const type = typeSelect.value;
            
            if (!verb) {
                alert('Por favor, introduce un verbo');
                return;
            }
            
            if (allVerbsData[verb] || customVerbs.some(v => v.verb === verb)) {
                alert('Este verbo ya existe');
                return;
            }
            
            const validEndings = {
                'regular-ar': 'ar',
                'regular-er': 'er', 
                'regular-ir': 'ir'
            };
            
            if (type !== 'irregular' && !verb.endsWith(validEndings[type])) {
                alert(`Los verbos ${type} deben terminar en -${validEndings[type]}`);
                return;
            }

            let verbData = { verb, type };

            if (type === 'irregular') {
                const confirmation = confirm(`Has seleccionado "Irregular" para "${verb}". Necesitas a√±adir sus conjugaciones manualmente. ¬øDeseas a√±adirlo como un verbo irregular gen√©rico por ahora? (Usar√° infinitivo con asterisco)`);
                if (confirmation) {
                    // Note: For custom irregular verbs, 'ustedes' conjugation would need to be manually specified if different from 'ellos/ellas'
                    verbData.conjugations = {
                        'yo': `${verb}*`, 't√∫': `${verb}*`, '√©l': `${verb}*`, 'ella': `${verb}*`, 'usted': `${verb}*`,
                        'nosotros': `${verb}*`, 'ustedes': `${verb}*`, 'ellos': `${verb}*`, 'ellas': `${verb}*` 
                    };
                } else {
                    return; 
                }
            } else {
                // Generate and store full conjugation for regular verbs
                verbData.conjugations = generateConjugation(verb, type);
            }
            
            customVerbs.push(verbData);
            saveCustomData(); // Save to localStorage
            
            updateVerbGrid();
            updateCustomVerbsDisplay();
            
            verbInput.value = '';
            typeSelect.value = 'regular-ar';
            
            alert(`¬°Verbo "${verb}" a√±adido correctamente!`);
        }

        function addNewNoun() {
            const nounInput = document.getElementById('newNoun');
            
            const noun = nounInput.value.trim().toLowerCase();
            
            if (!noun) {
                alert('Por favor, introduce un sustantivo');
                return;
            }
            
            if (defaultObjects.includes(noun) || customNouns.includes(noun)) {
                alert('Este sustantivo ya existe');
                return;
            }
            
            customNouns.push(noun);
            saveCustomData(); // Save to localStorage
            
            updateObjectGrid();
            updateCustomNounsDisplay();
            
            nounInput.value = '';
            
            alert(`¬°Sustantivo "${noun}" a√±adido correctamente!`);
        }

        function updateCustomVerbsDisplay() {
            const container = document.getElementById('customVerbs');
            while (container.children.length > 1) {
                container.removeChild(container.lastChild);
            }
            
            customVerbs.forEach((verbData, index) => {
                const tag = document.createElement('span');
                tag.className = 'custom-verb-tag';
                // Display type for custom verbs
                tag.innerHTML = `${verbData.verb} (${verbData.type}) <span class="remove-verb" onclick="removeCustomVerb(${index})">√ó</span>`;
                container.appendChild(tag);
            });
        }

        function updateCustomNounsDisplay() {
            const container = document.getElementById('customNouns');
            while (container.children.length > 1) {
                container.removeChild(container.lastChild);
            }
            
            customNouns.forEach((noun, index) => {
                const tag = document.createElement('span');
                tag.className = 'custom-noun-tag';
                tag.innerHTML = `${noun} <span class="remove-noun" onclick="removeCustomNoun(${index})">√ó</span>`;
                container.appendChild(tag);
            });
        }

        function removeCustomVerb(index) {
            const verbData = customVerbs[index];
            
            customVerbs.splice(index, 1);
            saveCustomData(); // Save to localStorage
            
            updateVerbGrid();
            updateCustomVerbsDisplay();
            
            if (selectedVerb === verbData.verb) {
                selectedVerb = null;
                updateSentence();
            }
        }

        function removeCustomNoun(index) {
            const noun = customNouns[index];
            
            customNouns.splice(index, 1);
            saveCustomData(); // Save to localStorage
            
            updateObjectGrid();
            updateCustomNounsDisplay();
            
            if (selectedObject === noun) {
                selectedObject = null;
                updateSentence();
            }
        }

        function updateSentence() {
            const builder = document.getElementById('sentenceBuilder');
            const info = document.getElementById('conjugationInfo');
            const details = document.getElementById('conjugationDetails');
            
            if (!selectedSubject && !selectedVerb && !selectedObject) {
                builder.innerHTML = '<span class="placeholder">Selecciona las palabras para construir tu oraci√≥n...</span>';
                info.style.display = 'none';
                return;
            }

            let sentenceHTML = '';
            
            if (selectedSubject) {
                sentenceHTML += `<span class="sentence-part selected-subject">${selectedSubject}</span>`;
            }
            
            if (selectedVerb && selectedSubject) {
                const verbEntry = customVerbs.find(v => v.verb === selectedVerb) || allVerbsData[selectedVerb];

                if (verbEntry && verbEntry.conjugations && verbEntry.conjugations[selectedSubject]) {
                    const conjugatedVerb = verbEntry.conjugations[selectedSubject];
                    sentenceHTML += `<span class="sentence-part selected-verb">${conjugatedVerb}</span>`;
                    
                    info.style.display = 'block';
                    const verbType = verbEntry.type === 'irregular' ? 'irregular' : `regular -${selectedVerb.slice(-2)}`;
                    
                    details.innerHTML = `
                        <strong>${selectedVerb}</strong> (${verbType}) conjugado con <strong>${selectedSubject}</strong> = <strong>${conjugatedVerb}</strong>
                        <br><small>Presente de indicativo</small>
                    `;
                } else {
                    sentenceHTML += `<span class="sentence-part selected-verb">${selectedVerb} (conjugaci√≥n no disponible)</span>`;
                    info.style.display = 'none';
                }
            } else if (selectedVerb) {
                sentenceHTML += `<span class="sentence-part selected-verb">${selectedVerb} (infinitivo)</span>`;
                info.style.display = 'none';
            } else {
                info.style.display = 'none';
            }
            
            if (selectedObject) {
                sentenceHTML += `<span class="sentence-part selected-object">${selectedObject}</span>`;
            }

            if (sentenceHTML) {
                builder.innerHTML = sentenceHTML;
            } else {
                builder.innerHTML = '<span class="placeholder">Selecciona las palabras para construir tu oraci√≥n...</span>';
            }
        }

        function clearSentence() {
            selectedSubject = null;
            selectedVerb = null;
            selectedObject = null;
            updateSentence();
        }

        // Initialize the grids and fetch data on load
        document.addEventListener('DOMContentLoaded', () => {
            loadCustomData(); // Load custom data FIRST
            fetchVerbsData(); // Then fetch default verbs (they merge into the display)
            updateObjectGrid(); // Objects can be updated right away after loading custom nouns
            updateCustomVerbsDisplay(); // Show loaded custom verbs
            updateCustomNounsDisplay(); // Show loaded custom nouns
        });
    </script>
</body>
</html>
